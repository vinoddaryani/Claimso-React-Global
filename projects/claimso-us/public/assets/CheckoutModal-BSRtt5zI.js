import{u as b,d as E,r as p,j as e,M as C,C as y,B as g,p as x,e as S}from"./index-DjALMzzH.js";const N=({isOpen:f,onClose:s,plan:r,purchase:t})=>{const n=b(),l=E(),[c,o]=p.useState(!1),[d,a]=p.useState(null),h=async j=>{if(j.preventDefault(),!(!n||!l)){o(!0),a(null);try{const{clientSecret:i}=await x.createPaymentIntent({amount:r.price,currency:r.currency,purchaseId:t.id,planId:r.partnerId,customerRegion:S()}),{error:m,paymentIntent:u}=await n.confirmCardPayment(i,{payment_method:{card:l.getElement(y),billing_details:{name:t.customerName||"Valued Customer"}}});if(m){a(m.message||"An error occurred during payment."),o(!1);return}if(u.status==="succeeded")try{await x.finalizeWarrantyPurchase(t.id,r,u.id),alert("Protection plan activated successfully!"),s()}catch(P){console.error("Fulfillment Error:",P),a("Payment succeeded, but we failed to activate your plan. Please contact support.")}}catch(i){a(i.message||"Could not initiate payment. Please try again."),o(!1)}}},v={style:{base:{color:"var(--text-primary)",fontFamily:"Inter, sans-serif",fontSize:"16px","::placeholder":{color:"var(--text-tertiary)"}},invalid:{color:"var(--accent-danger)",iconColor:"var(--accent-danger)"}}};return e.jsx(C,{isOpen:f,onClose:s,title:"Secure Checkout",customWidth:"400px",children:e.jsxs("form",{onSubmit:h,className:"checkout-form",children:[e.jsxs("div",{className:"plan-summary",style:{textAlign:"center",marginBottom:"var(--spacing-4)"},children:[e.jsxs("h4",{style:{margin:0},children:['Protection for "',t.name,'"']}),e.jsxs("p",{style:{color:"var(--text-secondary)",marginTop:"var(--spacing-2)"},children:["You are purchasing the ",e.jsx("strong",{style:{color:"var(--text-primary)"},children:r.partnerName})," plan."]})]}),e.jsx("div",{className:"card-element-container",style:{padding:"var(--spacing-3)",border:"1px solid var(--border-color)",borderRadius:"8px"},children:e.jsx(y,{options:v})}),d&&e.jsx("div",{className:"payment-error",style:{color:"var(--accent-danger)",marginTop:"var(--spacing-3)",textAlign:"center"},children:d}),e.jsxs("div",{className:"checkout-actions",style:{display:"flex",justifyContent:"flex-end",gap:"var(--spacing-3)",marginTop:"var(--spacing-5)"},children:[e.jsx(g,{type:"button",onClick:s,variant:"secondary",disabled:c,children:"Cancel"}),e.jsx(g,{type:"submit",disabled:!n||c,children:c?"Processing...":`Pay $${r.price.toFixed(2)}`})]})]})})};export{N as default};
